# Структура zav файлов для mat файлов

## Структура ZAV файлов

ZAV файлы - это MAT файлы с определенной структурой переменных, которые используются в приложении Eviewer и Easy Viewer для анализа электрофизиологических данных. Основываясь на анализе кода в `EasyView.m` и функций конвертации, вот обязательная структура:

### Обязательные переменные:

1. **`lfp`** - матрица LFP (Local Field Potential) данных
   - Размер: `[N, numChannels]` или `[N, numChannels, numSweeps]`
   - Где N - количество временных точек, numChannels - количество каналов
   - Если есть свипы (sweeps), то третий размер - количество свипов

2. **`hd`** - структура заголовка с метаданными
   - `fFileSignature` - подпись файла (например, "ABF2", "Neuralynx")
   - `nOperationMode` - режим работы
   - `lActualEpisodes` - количество эпизодов/свипов
   - `nADCNumChannels` - количество каналов
   - `recChNames` - массив имен каналов (cell array)
   - `recChUnits` - массив единиц измерения каналов (cell array)
   - `ch_si` - интервалы сэмплирования для каждого канала (в микросекундах)
   - `dataPtsPerChan` - количество точек данных на канал
   - `dataPts` - общее количество точек данных
   - `si` - интервал сэмплирования (в микросекундах)
   - `fADCSampleInterval` - интервал сэмплирования ADC
   - `recTime` - время записи [начало, конец]

3. **`zavp`** - структура параметров ZAV
   - `file` - путь к исходному файлу
   - `siS` - интервал сэмплирования в секундах
   - `dwnSmplFrq` - частота дискретизации после понижения (в Гц)
   - `stimCh` - канал стимуляции (может быть пустым)
   - `realStim` - структура с реальными стимулами
     - `r` - массив времен стимуляции (в единицах времени)

4. **`spks`** - структура спайков
   - Массив структур для каждого канала
   - Каждая структура содержит:
     - `tStamp` - временные метки спайков (в миллисекундах)
     - `ampl` - амплитуды спайков
     - `shape` - формы спайков (может быть пустым)

5. **`lfpVar`** - вариация LFP данных
   - Вектор вариаций для каждого канала

6. **`chnlGrp`** - группы каналов
   - Может быть пустым массивом `[]`

### Дополнительные поля в `hd` (в зависимости от источника данных):

- **Для Neuralynx данных:**
  - `adBitVolts` - коэффициенты преобразования бит-вольт
  - `dspDelay_mks` - задержки DSP
  - `inverted` - флаги инверсии каналов
  - `DSPLowCutFilterEnabled` - включение низкочастотных фильтров
  - `DspLowCutFrequency` - частоты низкочастотных фильтров
  - `DSPHighCutFilterEnabled` - включение высокочастотных фильтров
  - `DspHighCutFrequency` - частоты высокочастотных фильтров
  - `TTLs` - TTL события
  - `EventStrings` - строки событий
  - `inTTL_timestamps` - временные метки TTL

- **Для ABF данных:**
  - `sweepStartInPts` - начальные точки свипов
  - `protocolName` - имя протокола
  - `nADCSamplingSeq` - последовательность сэмплирования ADC
  - `fTelegraphAdditGain` - дополнительные коэффициенты усиления
  - `fInstrumentScaleFactor` - масштабные коэффициенты инструмента
  - `fSignalGain` - коэффициенты усиления сигнала
  - `fADCProgrammableGain` - программируемые коэффициенты усиления ADC
  - `fInstrumentOffset` - смещения инструмента
  - `fSignalOffset` - смещения сигнала

### Обработка свипов:

Если данные содержат свипы (третий размер `lfp` > 1), то функция `sweepProcessData` "распрямляет" данные, объединяя все свипы в один непрерывный временной ряд, а также корректирует временные метки стимулов и спайков.

Эта структура обеспечивает совместимость с Easy Viewer и позволяет корректно отображать и анализировать электрофизиологические данные различных форматов.

